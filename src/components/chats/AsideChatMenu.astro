---
import { Card } from "@/components/ui/card"
import AsideMenuItem from "@/components/AsideMenuItem.astro"
import { CreateChat } from "@/components/chats/create-chat"
import { Gamepad2, Search, User2 } from "lucide-react"
import { UserMenu } from "@/components/UserAsideMenu"
import { Image } from "astro:assets"
import { getSession } from "auth-astro/server"
import { UserChats } from "@/components/chats/userChats"

const session = await getSession(Astro.request)
const iniciado = session ? true : false
---

<nav class="flex flex-1 flex-col gap-2">
	<Card>
		<AsideMenuItem href="/">
			<Gamepad2 />
			GameLibrary
		</AsideMenuItem>
		<AsideMenuItem href="/search">
			<Search />
			Buscar
		</AsideMenuItem>

		<!-- Menu del usuario -->
		<UserMenu client:load data={iniciado}>
			{
				session ? (
					<p> {session.user?.name}</p>
				) : (
					<AsideMenuItem slot="usuario">
						<User2 /> User{" "}
					</AsideMenuItem>
				)
			}
			<AsideMenuItem slot="trigger">
				{
					session ? (
						<Image
							src={session.user?.image as string}
							alt={session.user?.name as string}
							class={"rounded-full"}
							width={24}
							height={24}
							decoding="async"
							loading="eager"
						/>
					) : (
						<User2 />
					)
				}
				{session ? <p> {session.user?.name}</p> : <p id="login-button"> User </p>}
			</AsideMenuItem>
			<p id="logout-button" slot="logout">Logout</p>
		</UserMenu>
		<!-- Menu del usuario -->
	</Card>
	<Card client:load>
		<AsideMenuItem>
			<div class="flex w-full flex-1 justify-between">
				<p class="flex items-center">mensajes directos</p>
				<CreateChat client:load />
			</div>
		</AsideMenuItem>
		<UserChats client:load />
	</Card>
</nav>
